---
title: 计算机网络笔记--Part7
comments: false
top: false
date: 2021-08-14 14:06:19
tags: [408,计算机网络]
categories: 
	- [个人笔记,计算机网络]
---

这系列记录翀翀🤠学习计算机网络时的核心笔记以及自己的思考，作为408组成学科之一，一定要认真学习。赠一言与君共勉：一个人的一生总会遇到这样的时刻，一个人的战争。在这种时候，你的心被颠倒了，但在别人眼里，你只是比平时安静一点，没有人会觉得奇怪。这种战争注定是单枪匹马的。

<!-- more -->

### 数据报与虚电路

前面一讲的最后我们学习了三种数据交换方式，其中分组交换现在被广泛应用。而分组交换根据其通信子网端点系统提供的服务，可以进一步分为面向连接的虚电路方式和无连接的数据报方式。这两种方式都由网络层提供。**但是我们要注意数据报方式和虚电路方式都是分组交换的两种不同方式**。

#### 数据报方式

当通信子网用户的端系统发送一个报文时，在端系统中实现的高层协议首先会把报文拆成若干个有序的数据单元，然后在网络层加上地址等控制信息形成数据报分组（即网络层的PDU）。中间节点存储分组一段时间后，找到最佳的路由后，就会尽快转发每一个分组。**注意不同的分组可以走不同的路径。也可以按照顺序抵达目的节点**。如下图是一个主机A向主机B发送报文的一个例子：

![](https://langwenchong.gitee.io/figure-bed/20210814155140.png)

步骤如下：

1. 主机A先将分组发往与他直接相连的交换节点A（我们后面学习到网络层就知道一般这种主机唯一相连的一个通向通信子网的节点对应的设备就是默认网关路由）。交换节点A缓存接收到的分组。
2. A节点接收到分组后首先会进行差错检测确保数据还是正确的，然后节点A查找自己的转发表，由于不同时刻的网络状态不同，因此转发表的内容在时刻发生变化，内容可能不是固定不动的，而是不同时刻完全不同的，因此所有的分组可能转发的路径是不同的，比如有的分组下一跳可能会转发到C，也有的分组会转发到D,F。
3. 网络中的其他中间节点接收到分组后，类似的存储转发分组直到分组最终到达主机B。

##### 思考：如果在转发过程中发生了错误怎么处理？

这里涉及到了选择重传机制的相关知识，我们简单描述一下这种重传的过程。我们要知道每次分组完成一跳后接收分组的节点都会对分组信息首先进行差错检测，而发送方此时并不会立刻从他的缓冲区中丢弃这个已发送分组的副本，而是会先保留直至接收到接收方节点反馈的信息（ACK或者NAK）。接受节点发现接收到的分组信息已经出错，那么就会反馈NAK告诉上一个发送节点，此时发送节点会重传这个分组，直至接收到ACK才会丢弃已发送分组的副本。如上图假设节点A接收到P1检测正确，那么会发送ACK告诉主机A成功接收分组P1，然后主机A会将缓冲区中的P1副本丢弃。此时节点A会保留P1副本，假设下一跳是C，那么C接收分组后同样要进行差错检测，很不幸发现数据错误，那么会反馈NAK，节点A受到NAK后会重传P1，这就是选择重传机制。

{% note info,

我们要注意当分组在链路上传送时，并不会占用网络中的其他部分资源，因为采用了存储转发的技术，因此资源都是共享的，所有当A发送分组时，主机B也可以同时向其他主机发送分组，并且此时通信网络中的中间节点也在时刻存储转发其他分组。

%}

我们通过上面的例子，可以总结出数据报服务具有如下的特点:

1. 数据报方式为网络层提供无连接服务，发送方可随时发送分组，网络中的节点可以随时接收分组，并且在存储转发过程中，并不会事先为分组的传输确定一条专有路径，每一个分组都是独立确定一条传输路径，因此不同分组传输路径不同，因此抵达时是乱序的。
2. 网络尽最大努力交付，传输不保证可靠性，所以可能在传输过程中丢失或者在环路中循环直至失效，因此分组并不一定能够抵达目的节点。
3. 发送的分组中包括了发送端和接收端的完整地址，以便可以独立传输。
4. 分组在交换节点存储转发时，需要排队等候处理，这会带来一定的时延。通过交换节点的通信量较大或者网络发生拥塞时，这种时延会大大增加，交换节点还可以根据情况丢弃部分分组。
5. 网络具有冗余路径，当某一交换节点或者某一段链路发生故障时，可相应的更新转发表，寻找另一条路径转发分组，对故障的适应能力增强，适用于突发性通信，但是不适用于长报文、会话式通信。
6. 存储转发的时延一般很小，提高了网络的吞吐量。
7. 收发双方不独占某一条链路，因此资源利用率高。

#### 虚电路方式

虚电路方式试图将数据报方式和电路交换方式结合起来，充分发挥两种方法的优点，以达到最佳的数据交换效果。在分组发送之前，要求在发送方和接收方之间要建立一条逻辑上相连的虚电路，并且连接一旦建立，就固定了虚电路对应的物理路径。与电路交换类似，整个通信过程分为三个阶段：虚电路建立、数据传输和虚电路释放。

![](https://langwenchong.gitee.io/figure-bed/20210814164340.png)

在虚电路方式中，端系统每次要建立虚电路时，选择一个未用过的虚电路号分配给虚电路，以区别于本系统的其他虚电路。在传送数据时，每个数据分组不仅要有分组号、校验和等控制信息，还要有他要通过的虚电路号，以区别于其他虚电路上的分组。并且在虚电路网络中的每一个节点都要维持一张虚电路表，表中的每项记录了一个打开的虚电路的信息，包括在接受链路和发送链路上的虚电路号、前一节点和下一节点的标识。数据的传输时双向进行的，上述信息是在虚电路的建立过程中确定的。

这里我们同样给出一个主机A向主机B发送数据的例子：

![](https://langwenchong.gitee.io/figure-bed/20210814162424.png)

1. 首先为进行数据传输，主机A与主机B之间先建立一条逻辑通路，主机A发出一个特殊的`呼叫请求`分组，该分组通过中间节点数据报的方式送往主机B，如果主机B同意连接，则发送`呼叫应答`请求分组予以确认。
2. 虚电路建立后，就形成了一条固定的物理路径供双发发送数据，例如上图的虚电路时主机A->节点A->节点B->节点C->节点D->主机B，这样主机A就可以一直通过这条逻辑虚电路向主机B发送数据，同时主机B也可以在这条虚电路上向主机A发送数据。
3. 当所有分组都有序的抵达主机B后，传送结束后，A发送通过虚电路方式`释放请求`分组来拆除虚电路，逐段断开整个连接。

{% note info,

我们要注意无论是数据报方式还是虚电路方式，在数据传输过程中都是有确认的传输（由高层实现，主机B收到分组后要发回相应分组的确认。但是网络中的传输是否有确认机制与网络层提供的两种服务是没有任何关系的，也就是说明基于数据报方式和虚电路方式实现的服务未必就是有确认机制的，他需要额外的机制来确认。

%}

##### 思考：为什么建立时是数据报方式，而释放时确实虚电路方式？

实际上很难好像，首先建立前还没有确定虚电路，因此只能通过数据报的方式发送请求连接的分组。但是当释放连接分组发送时，却已经有现成的虚电路了，并且释放连接分组按照虚电路的路径传送也可以顺便通知虚电路对应的物理路径上的各个交换节点释放对应的虚电路表上的虚电路号表项。

##### 思考：虚电路方式和电路交换的区别？虚电路方式为什么是分组交换的一种，体现在哪里？

我们可能学习完虚电路方式后会混淆他和电路交换方式。实际上很好理解分辨两者的区别。首先电路交换方式是直接建立一条独占专用的物理信道路径收发双方使用，并且数据并不需要切割必须使用特定大小的分组来传输，因为电路交换方式是直接使用了一个信道的所有带宽，是非常充足的，完全没有必要分割的。而虚电路方式是仅仅形式上和电路交换类似，但是本质上还是分组交换的特点，首先一点，他就是必须使用分组进行传输，同时建立一条专用的逻辑虚电路和电路交换方式中的建立一条专用的物理信道电路区别很大。这里的虚电路仅仅强调的是对应物理路径是确定的即必须经过特点的交换节点，而不受占用一条物理路径，这也就意味着对于主机A->节点A->节点B->节点C->节点D->主机B这要路径上的交换节点并不是只能服务与这一条虚电路，他还可以服务与其他虚电路，比如还有一条虚电路是主机A->节点A->节点B->节点G->节点F->主机C，此时的节点A，节点B和节点C同时服务了两条虚电路，但是逻辑上这两条虚电路是专用于某一个收发双方的数据传输的，这就是虚电路的特点。也正是由于一个中间节点可能需要服务于多条虚电路，因此他需要区分不同的虚电路，因此我们需要为每一条虚电路分配一个独一无二的虚电路号从而在交换节点的虚电路表中加以区分。

##### 思考：虚电路方式借鉴了电路交换的哪些优点?

首先当然就是更加安全稳定，并且分组是有序到达的。同时他也有类似于全双工的数据传输特点，但是同时，他又避免了电路交换中信道利用率低的特点。从每一个信道的视角来看，每一个信道的带宽都能够被充分利用服务与多条虚电路的服务，但是从每一个虚电路交换的数据传输视角来看，他自身确实在使用一条逻辑专用通道，完美复现了电路交换的优点。

因此我们可以总结电路交换有以下的特点：

1. 虚电路方式为网络层提供连接服务，源节点与目的节点之间建立一条逻辑连接，而非物理连接的通道。因此首先需要为分组的传输确定传输路径（建立连接），然后沿该路径（连接）传输系列分组，系列分组传输路径相同，传输结束后拆除连接。
2. 但是虚电路通信链路的建立和拆除需要时间开销，对交互式应用和小量的短分组情况显得很浪费，但对长时间、频繁的数据交换效率较高。
3. 虚电路的路由选择体现在建立阶段，连接建立后，就确定了传输路径。
4. 虚电路提供了可靠的通信功能，能保证每个分组正确有序到达。此外，还可以对两个数据端点的流量进行控制，当接收方来不及接收数据是，可以通知发送方暂缓发送。
5. 虚电路有一个致命的弱点，即当网络中的某个节点或某条链路出现故障而彻底失效时，所有经过该节点或该链路的虚电路将遭到破坏。
6. 分组首部并不包含目的地址，而包含虚电路标识符，相对数据报方式开销小。

{% note info,

虚电路之所以是虚的，就是因为这条电路不是专用的，每一个节点到其他节点之间的链路可能同时有若干虚电路通过，也可能同时与多个节点之间建立虚电路。每一条虚电路支持特定的两个端系统之间的数据传输，两个端系统之间也可以有多条虚电路为不同的进程服务，这些虚电路的实际路由可能相同也可能不同。

%}

#### 两种分组交换方式的对比

|                    |                         数据报服务                         |                          虚电路服务                          |
| :----------------: | :--------------------------------------------------------: | :----------------------------------------------------------: |
|     连接的建立     |                            不要                            |                            必须有                            |
|      目的地址      |                每一个分组都有完整的目的地址                | 仅在建立阶段使用，之后每一个分组使用长度较短的虚电路号来确定路径 |
|      路由选择      |              每一个分组独立进行路由选择和转发              |            属于同一条虚电路的分组按照同一路由转发            |
|      分组顺序      |                    不保证分组的有序到达                    |                      保证分组的有序到达                      |
|       可靠性       |           不保证可靠通信，可靠性由用户主机来保证           |                       可靠性由网络保证                       |
| 对网络故障的适应性 | 出故障的节点丢失分组，其他分组路径选择发生变化，可正常传输 |            所有经过故障节点的虚电路均不能正常工作            |
| 差错控制和流量控制 |        由用户主机进行流量控制，不保证数据报的可靠性        |            可由分组交换网负责，也可由用户主及负责            |

最后我们要牢记数据报方式和虚电路交换方式都是分组交换的一种，他们分别应用于UDP和TCP中，并且各有千秋无优劣之分。

### 传输介质

传输介质也称为传输媒体/传输媒介，他就是数据传输系统在发送设备和接收设备之间的物理通路。传输介质可以分为导向传输介质和非导向传输介质。在导向传输介质中，电磁波被导向沿着固体媒介（铜线或光纤）传播，而对于非导向传输介质可以是空气、真空或者海水等。

![](https://langwenchong.gitee.io/figure-bed/20210815113340.png)

{% note info,

我们要注意传输媒体并不属于物理层，传输媒体在物理层的下面，因为物理层是体系结构中的第一层，因此有时也称传输媒体为第0层。在传输媒体中传输的是信号，但是传输媒体却并不知道传输的信号是什么意思。而物理层规定了电气特性，因此能够识别所传送的比特流。

 %}

#### 思考：传输媒体和物理层的主要区别？

![](https://langwenchong.gitee.io/figure-bed/20210815123944.png)

在传输媒体中传输的是信号，但是传输媒体并不知道所传输的信号是代表什么，也就是说，传输媒体不知道信号什么时候是1什么时候是0.但是物理层由于规定了电气特性，因此能够识别所传送的比特流。

#### 导向性传输介质

##### 双绞线

双绞线是最古老、又最常用的传输介质，它采用两根采用一定规则并排绞和、相互绝缘的铜导线组成。

![](https://langwenchong.gitee.io/figure-bed/20210815113935.png)

绞和可以减少对相邻导线之间的电磁干扰。为了进一步提高抗电磁干扰能力，我们还可以在双绞线的外面再加上一个由金属丝编织而成的屏蔽层，这就是屏蔽双绞线（STP），无屏蔽层的双绞线就称为非屏蔽双绞线（UTP)。

双绞线价格便宜，是最常用的传输介质之一，在局域网和传统电话网中普遍使用。模拟传输和数字传输都可以使用双绞线，其通信距离一般为几公里到几十公里，距离太远时，对于模拟传输，要使用放大器放大衰减的信号，对于数字传输，要使用中继器将失真的信号整型。

##### 同轴电缆

同轴电缆由导体铜质芯线、绝缘层、网状编址屏蔽层和塑料外层组成。按特性阻抗数值的不同，通常将同轴电缆分为两类：50Ω同轴电缆和75Ω同轴电缆。其中，50Ω同轴电缆主要用于传送基带数字信号，又称为基带同轴电缆，他在局域网中得到广泛应用，而75Ω同轴电缆主要用于传送宽带信号，又称为宽带同轴电缆，主要用于有线电视系统。

![](https://langwenchong.gitee.io/figure-bed/20210815114653.png)

由于外导体屏蔽层的作用，同轴电缆抗干扰特性比双绞线好，被广泛应用于传输较高速率的数据，其传输距离更远，但是价格也比双绞线更高。

##### 光纤

光纤导线就是利用光导纤维（简称光纤）传输光脉冲来进行通信。有光脉冲表示1，无光脉冲表示0。而可见光的频率大概是10^8dMHz,因此光纤通信系统的带宽远远大于目前其他各种传输媒体的带宽。

光纤在发送端有光源，可以采用发光二极管或者半导体激光，他们在电脉冲作用下能产生出光脉冲，在接收端用光电二极管做成光检测器，在检测时还可还原出电脉冲。

光纤主要由纤芯（实心的）和包层构成，光波通过纤芯进行传导，包层较纤芯有较低的折射率。当光纤从高折射率的介质射向较低折射率的介质时，其折射角大于入射角。因此，如果入射角足够大，就会出现全反射，即光纤碰到包层时就会折射回纤芯、这个过程不断重复，光也就沿着光纤传输下去。

![](https://langwenchong.gitee.io/figure-bed/20210815115522.png)

光纤传输又分为多模光纤和单模光纤：

![](https://langwenchong.gitee.io/figure-bed/20210815115646.png)

- 多模光纤：只要从纤心射到纤心表面的光纤的入射角大于某个临界角度，就会产生全反射。因此，从不同角度入射的多束光线可在一条光纤中传输，这种光纤称为多模光纤。多模光纤的光源为发光二极管。光脉冲在多模光纤中传输时会逐渐展宽，造成失真，因此多模光纤只适合于近距离传输。
- 单模光纤：光纤的直径减小到一个光波长度时，光纤就像一根波导那样，可使光线一直向前传播，而不会产生多次反射，这样的光纤就是单模光纤。单模光纤的纤心很细，直径只有几微米，制造成本高。同时单模光纤的光源为定向性很好的激光二极管，因此单模光纤的衰减较小，适合于远距离传输。

![](https://langwenchong.gitee.io/figure-bed/20210815120157.png)

我们可以总结光纤有如下特点:

1. 传输损耗小，中继距离长，对远距离传输特别经济
2. 抗雷电和电磁干扰性能好
3. 无串音干扰，保密性好，也不易被窃听和截取数据
4. 体积小，重量轻

#### 非导向性传输介质

无限通信已广泛应用于移动电话领域，构成蜂窝式无线电话网。随着便携式计算机的出现，以及在军事、野外等特殊场合下移动通信联网的需要，促进了数字化移动通信的发展，现在无线局域网产品的应用已经非常普遍。

![](https://langwenchong.gitee.io/figure-bed/20210815121547.png)

##### 无线电波

无线电波穿透能力强，可以传输很长的距离，所以被广泛应用于通信领域，如无线手机通信、计算机网中的无线局域网（WLAN）等。因为无线电波使信号向所有方向散播，因此有效距离范围内的接受设备无需对准某个方向接收，就可以与无线电波发射者进行通信连接，大大简化了通信连接。这也是无线电传输的最重要的优点之一。

##### 微波、红外线和激光

目前高宽带的无线通信技术就是微波、红外线和激光这三种通信技术。他们都需要发送方和接收方之间存在一条视线通路，有很强的方向性，都沿直线传播，有时这三者又统称为视线介质。不同的是，红外线通信和激光通信把要传输的信号分别转换为各自的信号格式，即红外线信号和激光信号，再直接在空间中传播。

微波通信的频率较高，频段范围也很宽，载波频率通常为2~40GHz，因而通信信道的容量大。例如一个带宽为2MHz的频段可以容纳500条的语音线路，若用来传输数字信号，数据率可达Mb/s的级别。与通常的无线电波不同，微波通信的信号是沿直线传播的，因此在地面的传播距离有限，超过一定距离后需要中继站来接力。

但是微波信号在卫星通信中作用极大，卫星通信利用地球同步卫星作为中继来转发微波信号，可以克服地面微波通信距离的限制。三颗相隔120°的同步卫星几乎能覆盖整个地球表面，因而能够实现全球通信。卫星通信的优点是通信容量大、距离远、覆盖广，缺点是端到端的传播时延长，一般为250~270ms。

### 物理层设备

#### 中继器

中继器诞生的原因就是解决线路上由于损耗而导致信号衰减甚至失真的问题的。它能够对信号进行再生和还原，对衰减的信号进行放大，保持与原数据相同，以增加信号传输的距离，延长网络的长度。

![](https://langwenchong.gitee.io/figure-bed/20210815122132.png)

中继器两端的网络部分是网段，而不是子网，适**用于完全相同的两类网络的互联**，**且两个网段速率要相同**。中继器只将任何电缆段上的数据发送到另一段电缆上，它仅作用于信号的电气部分，并不管数据中是否有错误数据或不适用于网络的数据。同时中继器可以连相同的媒体，也可以连不同的媒体。**只要中继器两端的网段一定要是同一个协议即可，同时中继器不会存储转发（傻🤣）。**

{% note info,

所谓网段就是指一个计算机网络中使用同一物理层设备（传输介质，中继器，集线器等）直接通讯的那一部分。比如从一个IP到另一个IP 好比 从192.168.0.1到192.168.255.255这之间就是一个网段

%}

网络标准中都对信号的延迟范围作了具体的规定（5-4-3规则），因而中继器只能在规定的范围内进行，否则会出现网络故障。

![](https://langwenchong.gitee.io/figure-bed/20210815122632.png)

所谓的`5-4-3规则`就是指在10M以太网中，网络总长度不得超过5个网段，4台网络延长设备，且5个区段中只有3个区段可接网络设备。如上图我们发现有5个线段表示5个网段，4个蓝色矩形表示4台中继设备，和三个可以接入这个以太网的网络设备。

#### 集线器（多口中继器）

集线器的功能是对信号进行**再生放大转发**，对衰减的信号进行放大，接着转发到其他所有（除了输入端口）处于工作状态的端口上（优点类似于广播），以增加信号的传输距离，延长网络的长度。因此也说明他不具备定向传送能力，是一个共享式设备。

![](https://langwenchong.gitee.io/figure-bed/20210815123202.png)

### 物理层接口的特性

物理层考虑的是如何在连接到各台计算机的传输媒体上传输数据比特流，而不指具体的传输媒体。物理层应尽可能屏蔽各种物理设备的差异，使数据链路层只考虑本层的协议和服务。物理层的主要任务可以描述为确定与传输媒体的接口有关的一些特性：

1. 机械特性：主要定义为物理连接的边界点，即接插装置。规定物理连接时所采用的的规格、引线的数目、引脚的数量和排列情况。
2. 电气特性：规定传输二进制位时，线路上信号的电压高低、阻抗匹配、传输速率和距离限制等。
3. 功能特性：指明某条线上出现的某一电平的电压表示何种意义，接口部件的信号线（数据线、控制线、定时线等）的用途。
4. 规程特性：主要定义各物理线路的工作规程和时序关系。

常用的物理层接口标准有EIA RS-232-C、ADSL和SONET/SDH等。

### 总结

自此我们大体上学习完了物理层的所有知识点，一下是知识脑图：

![](https://langwenchong.gitee.io/figure-bed/20210815132432.png)